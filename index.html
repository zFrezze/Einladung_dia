<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Einladung</title>
<style>
  :root{
    --ink:#0e1b2b;
    --paper-hi:#ffffff; --paper-mid:#eef2f7; --paper-lo:#dfe6ee;
    --liner-hi:#ffffff; --liner-lo:#eaf0f7;
    --shadow-strong: 0 30px 90px rgba(10,20,40,.28);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;display:grid;place-items:center;background:linear-gradient(180deg,#f9fbff,#edf3fa);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);
    overflow:hidden;padding:18px
  }

  .env-frame{position:relative;width:min(700px,94vw);aspect-ratio:4/3;perspective:1800px;overflow:visible}
  .env-body{position:absolute;inset:0;border-radius:18px;z-index:2;overflow:hidden;
    background:linear-gradient(180deg,var(--paper-hi),var(--paper-mid) 60%,var(--paper-lo));box-shadow:var(--shadow-strong)}
  .env-liner{position:absolute;inset:0;border-radius:18px;z-index:1;opacity:0;
    background:linear-gradient(180deg,var(--liner-hi),var(--liner-lo))}
  .env-patch{position:absolute;inset:0;border-radius:18px;z-index:2;opacity:0;
    background:var(--liner-hi);clip-path:polygon(0 0,100% 0,50% 57%)}
  .flap-top{position:absolute;inset:0;z-index:4;transform-style:preserve-3d;
    background:linear-gradient(180deg,#ffffff,#f3f7fb);clip-path:polygon(0 0,100% 0,50% 57%);
    transform-origin:50% 0%;transform:rotateX(0deg)}
  .flap-shadow{position:absolute;left:8%;right:8%;top:52%;height:18px;z-index:3;
    background:radial-gradient(50% 100% at 50% 0%, rgba(0,0,0,.22), transparent 70%);opacity:.6}

  /* Siegel */
  .seal-wrap{position:absolute;left:50%;top:48%;transform:translate(-50%,-50%);
    width:140px;height:140px;z-index:6}
  .seal-intact{position:absolute;inset:0;display:grid;place-items:center}
  .seal-intact img{width:100%;height:auto;display:block}
  .seal-hh{position:absolute;inset:0;display:grid;place-items:center;
    font:700 30px/1 Georgia,serif;color:rgba(255,255,255,.96);text-shadow:0 2px 6px rgba(0,0,0,.35)}

  /* Karte */
  .card-wrap{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    width:min(460px,76vmin);height:min(460px,76vmin);z-index:3;clip-path:polygon(0 0,100% 0,50% 57%)}
  .card-front,.card-back{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) translateY(60%) scale(.48);
    width:100%;height:auto;opacity:.95;filter:drop-shadow(0 30px 70px rgba(0,0,0,.25));
    user-select:none;backface-visibility:hidden}
  .card-back{transform:translate(-50%,-50%) translateY(60%) scale(.48) rotateY(180deg);opacity:0}
</style>
</head>
<body>
  <div class="env-frame" id="frame">
    <div class="env-body"></div>
    <div class="env-liner" id="envLiner"></div>
    <div class="env-patch" id="envPatch"></div>
    <div class="flap-top" id="flapTop"></div>
    <div class="flap-shadow" id="flapShadow"></div>

    <!-- Siegel -->
    <div class="seal-wrap" id="sealWrap">
      <div class="seal-intact" id="sealIntact">
        <img src="seal.png" alt="Siegel">
        <div class="seal-hh">HH</div>
      </div>
      <!-- Canvas-Fragmente kommen per JS -->
    </div>

    <!-- Karte -->
    <div class="card-wrap" id="cardWrap" aria-hidden="true">
      <img src="diamond.png" alt="Vorderseite" id="cardFront" class="card-front">
      <img src="diamond_2.jpg" alt="RÃ¼ckseite" id="cardBack" class="card-back">
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script>
    let state=0;
    const flapTop=document.getElementById('flapTop');
    const flapShadow=document.getElementById('flapShadow');
    const envLiner=document.getElementById('envLiner');
    const envPatch=document.getElementById('envPatch');
    const sealWrap=document.getElementById('sealWrap');
    const sealIntact=document.getElementById('sealIntact');
    const cardFront=document.getElementById('cardFront');
    const cardBack=document.getElementById('cardBack');

    /* Siegel-Polygone (wie Teil 1) */
    const POLYS = [
      [ {x:.50,y:.10},{x:.86,y:.22},{x:.92,y:.40},{x:.70,y:.52},{x:.52,y:.42} ],
      [ {x:.52,y:.42},{x:.70,y:.52},{x:.64,y:.78},{x:.48,y:.90},{x:.42,y:.64} ],
      [ {x:.42,y:.64},{x:.48,y:.90},{x:.22,y:.84},{x:.14,y:.62},{x:.28,y:.48} ],
      [ {x:.28,y:.48},{x:.14,y:.62},{x:.10,y:.38},{x:.28,y:.22},{x:.50,y:.10} ],
    ];
    const sealImg = new Image();
    sealImg.src = "seal.png";
    sealImg.onload = () => createSealFragments(sealImg);

    function createSealFragments(img){
      Array.from(sealWrap.querySelectorAll('canvas.seal-frag')).forEach(n=>n.remove());
      const size = Math.round(sealWrap.clientWidth || 140);
      POLYS.forEach(poly=>{
        const c = document.createElement('canvas');
        c.className = 'seal-frag';
        c.width = size; c.height = size;
        c.style.position="absolute";
        c.style.inset="0";
        c.style.display="none";
        sealWrap.appendChild(c);
        const g = c.getContext('2d');

        g.save(); g.beginPath();
        poly.forEach((p,i)=>{ const x=p.x*size,y=p.y*size;i?g.lineTo(x,y):g.moveTo(x,y); });
        g.closePath(); g.clip();

        const iw=img.width, ih=img.height, s=Math.max(size/iw, size/ih);
        g.drawImage(img,(size-iw*s)/2,(size-ih*s)/2, iw*s, ih*s);
        g.restore();

        g.globalCompositeOperation='multiply';
        g.fillStyle='rgba(0,0,0,.06)';
        g.beginPath();
        poly.forEach((p,i)=>{ const x=p.x*size,y=p.y*size;i?g.lineTo(x,y):g.moveTo(x,y); });
        g.closePath(); g.fill();
      });
    }

    function breakSeal(){
      gsap.to(sealIntact,{
        duration:.18,scale:1.06,ease:"power2.out",yoyo:true,repeat:1,
        onComplete(){
          sealIntact.style.display='none';
          const frags = Array.from(sealWrap.querySelectorAll('canvas.seal-frag'));
          frags.forEach((c,i)=>{
            c.style.display='block';
            const dir = [
              {x:0.85,y:-0.40,r:16},
              {x:0.55,y:0.85,r:12},
              {x:-0.70,y:0.70,r:-14},
              {x:-0.95,y:-0.20,r:-18},
            ][i];
            const dist = 95 + Math.random()*40;
            gsap.to(c,{duration:.75,x:dir.x*dist,y:dir.y*dist,rotation:dir.r,ease:"power2.out"});
            gsap.to(c,{duration:.35,opacity:0,delay:.55,onComplete:()=>c.remove()});
          });
        }
      });
      state=1;
    }

    function openEnvelopeAndCard(){
      gsap.to(flapTop,{duration:2,rotationX:-120,ease:"power2.inOut"});
      gsap.to(flapShadow,{duration:2,opacity:.2,y:-24,ease:"power2.inOut"});
      gsap.to(envLiner,{duration:.9,opacity:1,delay:.5});
      gsap.to(envPatch,{duration:.9,opacity:1,delay:.5});

      const tl=gsap.timeline({delay:.95,defaults:{ease:"power2.inOut"}});
      tl.to([cardFront,cardBack],{duration:1.7,y:"-=90%",scale:.25,rotation:-8,opacity:1});
      tl.add(()=>{document.querySelector('.card-wrap').style.clipPath='none'});
      tl.to([cardFront,cardBack],{duration:1.6,y:"-50%",scale:1.25,rotation:0});
      
      // automatischer Flip nach 1.5s
      tl.add(()=>{
        setTimeout(()=>{
          gsap.to(cardFront,{duration:1,rotationY:180,opacity:0});
          gsap.to(cardBack,{duration:1,rotationY:0,opacity:1,delay:.1});
        },1000);
      });
      state=2;
    }

    document.getElementById('frame').addEventListener('click',()=>{
      if(state===0) breakSeal();
      else if(state===1) openEnvelopeAndCard();
    });
  </script>
</body>
</html>
