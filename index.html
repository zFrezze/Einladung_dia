<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Einladung</title>
<style>
  :root{
    --bg: #f2f6fb;
    --ink:#0e1b2b;
    --shadow: 0 24px 70px rgba(10,20,40,.18);
    --ease: cubic-bezier(.2,.8,.2,1);
    --dur: .95s;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; display:grid; place-items:center; background:linear-gradient(180deg,#ffffff, #eef4fa);
    color:var(--ink); font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    overflow:hidden; padding:18px;
  }

  .stage{ width:min(960px,100%); display:grid; gap:12px; justify-items:center; }
  .hint{ font-size:.9rem; opacity:.7; text-align:center; margin:0 0 6px }

  /* Envelope frame */
  .env-frame{
    position:relative; width:min(640px, 94vw); aspect-ratio: 4 / 3; perspective:1600px;
    isolation:isolate;
  }

  /* Static body (paper texture) */
  .env-body{
    position:absolute; inset:0; border-radius:14px; overflow:hidden; z-index:1;
    background: url("envelope.jpg") center/cover no-repeat;
    box-shadow: var(--shadow);
  }

  /* Two flaps (open left/right) — we reuse the same texture for continuity */
  .flap{ position:absolute; inset:0; z-index:3; transform-style:preserve-3d; }
  .flap-left, .flap-right{
    position:absolute; top:0; width:50%; height:100%; background:url("envelope.jpg") center/cover no-repeat;
    will-change: transform; backface-visibility:hidden;
  }
  .flap-left{ left:0; border-top-left-radius:14px; border-bottom-left-radius:14px; transform-origin: left center; }
  .flap-right{ right:0; border-top-right-radius:14px; border-bottom-right-radius:14px; transform-origin: right center; }

  /* A faint horizontal band for depth (optional) */
  .band{ position:absolute; left:0; right:0; top:40%; height:10%; background:linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,0)); mix-blend-multiply; z-index:4; pointer-events:none; }

  /* Seal area */
  .seal-wrap{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%, -40%); /* leicht über Mitte */
    width:130px; height:130px; z-index:6; pointer-events:auto;
  }
  canvas.seal-frag{ position:absolute; inset:0; width:100%; height:100%; }
  .seal-hh{
    position:absolute; inset:0; display:grid; place-items:center; z-index:7; pointer-events:none;
    font: 700 30px/1 Georgia, 'Times New Roman', serif; color: rgba(255,255,255,.95); text-shadow: 0 2px 6px rgba(0,0,0,.35);
  }

  /* Diamond card container (over envelope) */
  .diamond-wrap{
    position:absolute; left:50%; top:52%; transform:translate(-50%,-50%);
    width:min(420px, 75vmin); height:min(420px, 75vmin);
    z-index:5; pointer-events:none;
  }
  .diamond{
    position:absolute; inset:0; transform: rotate(45deg) scale(.2);
    transform-origin:center; will-change:transform, opacity; opacity:0;
    filter: drop-shadow(0 30px 70px rgba(0,0,0,.25));
    pointer-events:auto; cursor:pointer;
  }

  /* Diamond pieces (4 flaps) — all use the same bg image */
  .piece{ position:absolute; width:50%; height:50%; background:url("diamond.jpg") center/cover no-repeat;
          border:1px solid rgba(0,0,0,.08); backface-visibility:hidden; transform-style:preserve-3d; }
  .top{ left:25%; top:0; transform-origin:50% 100%; }
  .right{ right:0; top:25%; transform-origin:0% 50%; }
  .bottom{ left:25%; bottom:0; transform-origin:50% 0%; }
  .left{ left:0; top:25%; transform-origin:100% 50%; }

  /* Inner square content (rotated back inside the diamond) */
  .inner{
    position:absolute; left:18%; top:18%; width:64%; height:64%;
    transform: rotate(-45deg);
    background: #fff; border-radius:14px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    padding:14px; text-align:center; opacity:0;
  }
  .inner h2{ margin:.2rem 0 .6rem; font-size: clamp(1.1rem, 2.4vw, 1.5rem); }
  .inner p{ margin:.2rem 0; color:#2a3a4a; font-size:.98rem; }

  /* Buttons hover hints (optional) */
  .click-hint{ position:absolute; left:50%; top:8px; transform:translateX(-50%); font-size:.85rem; opacity:.7; }

  @media (max-width:540px){
    .seal-wrap{ width:100px; height:100px; transform:translate(-50%, -38%); }
  }
</style>
</head>
<body>
  <div class="stage">
    <p class="hint">Klick 1: Siegel zersplittert · Klick 2: Kuvert klappt in zwei Hälften auf & Karte zoomt · Klick auf Diamant: Karte klappt auf</p>

    <div class="env-frame" id="frame" role="region" aria-label="Einladung">
      <!-- envelope body (dein Bild) -->
      <div class="env-body" id="envBody" aria-hidden="true"></div>

      <!-- two opening halves -->
      <div class="flap" aria-hidden="true">
        <div class="flap-left" id="flapLeft"></div>
        <div class="flap-right" id="flapRight"></div>
      </div>
      <div class="band" aria-hidden="true"></div>

      <!-- seal (canvas fragments + HH on top) -->
      <div class="seal-wrap" id="sealWrap" title="Siegel">
        <!-- Canvas-Fragmente werden per JS erzeugt -->
        <div class="seal-hh" id="sealHH">HH</div>
      </div>

      <!-- diamond card -->
      <div class="diamond-wrap" id="diamondWrap" aria-hidden="true">
        <div class="diamond" id="diamond" tabindex="0" role="button" aria-label="Diamantkarte">
          <div class="piece top"></div>
          <div class="piece right"></div>
          <div class="piece bottom"></div>
          <div class="piece left"></div>
          <div class="inner" id="inner">
            <h2>Einladung</h2>
            <p><strong>Wann:</strong> 12. Oktober 2025 · 18:00</p>
            <p><strong>Wo:</strong> Crystal Hall, Hauptstraße 12</p>
            <p>Wir freuen uns auf dich! ✨</p>
          </div>
        </div>
      </div>

      <div class="click-hint" id="clickHint">Klick aufs Siegel</div>
    </div>
  </div>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script>
    /* ==== CONFIG: Bild-Dateien im Repo-Root ==== */
    const SEAL_IMAGE = "seal.png";        // transparentes Wachs-Siegel (deins)
    const ENVELOPE_IMAGE = "envelope.jpg"; // dein Kuvert-Bild (bereits gesetzt via CSS-Hintergrund)
    const DIAMOND_IMAGE = "diamond.jpg";   // Platzhalter-Textur (später ersetzen)

    /* ==== DOM ==== */
    const frame = document.getElementById('frame');
    const sealWrap = document.getElementById('sealWrap');
    const sealHH = document.getElementById('sealHH');
    const flapLeft = document.getElementById('flapLeft');
    const flapRight = document.getElementById('flapRight');
    const diamondWrap = document.getElementById('diamondWrap');
    const diamond = document.getElementById('diamond');
    const inner = document.getElementById('inner');
    const clickHint = document.getElementById('clickHint');

    /* ==== State ==== */
    // 0: initial (Siegel intakt) → 1. Klick: zersplittern
    // 1: Siegel kaputt → 2. Klick: Kuvert öffnet & Diamant zoomt
    // 2: Diamant sichtbar → Klick auf Diamant: aufklappen
    let state = 0;
    let diamondOpen = false;

    /* ==== Seal: in 4 sinnvolle Fragmente schneiden ==== */
    // Polygone in normierten Koordinaten (0..1) so, dass sie zusammen wieder Kreis / organische Form ergeben
    const POLYS = [
      [ {x:.50,y:.10},{x:.86,y:.22},{x:.92,y:.40},{x:.70,y:.52},{x:.52,y:.42} ],
      [ {x:.52,y:.42},{x:.70,y:.52},{x:.64,y:.78},{x:.48,y:.90},{x:.42,y:.64} ],
      [ {x:.42,y:.64},{x:.48,y:.90},{x:.22,y:.84},{x:.14,y:.62},{x:.28,y:.48} ],
      [ {x:.28,y:.48},{x:.14,y:.62},{x:.10,y:.38},{x:.28,y:.22},{x:.50,y:.10} ],
    ];

    function createSealFragments(img){
      // Clear old
      Array.from(sealWrap.querySelectorAll('canvas.seal-frag')).forEach(n=>n.remove());

      const size = Math.round(sealWrap.clientWidth);
      POLYS.forEach((poly, idx)=>{
        const c = document.createElement('canvas');
        c.className = 'seal-frag';
        c.width = size; c.height = size;
        sealWrap.prepend(c);
        const g = c.getContext('2d');
        // Clip to polygon
        g.save();
        g.beginPath();
        poly.forEach((p,i)=>{
          const x = p.x*size, y = p.y*size;
          if(i===0) g.moveTo(x,y); else g.lineTo(x,y);
        });
        g.closePath();
        g.clip();

        // Draw seal image "cover"
        const iw = img.width, ih = img.height;
        const scale = Math.max(size/iw, size/ih);
        const dw = iw*scale, dh = ih*scale;
        g.drawImage(img, (size-dw)/2, (size-dh)/2, dw, dh);

        g.restore();

        // Leichte Schattierung für Relief
        g.globalCompositeOperation = 'multiply';
        g.fillStyle = 'rgba(0,0,0,.06)';
        g.beginPath();
        poly.forEach((p,i)=>{ const x=p.x*size,y=p.y*size; if(i===0) g.moveTo(x,y); else g.lineTo(x,y); });
        g.closePath(); g.fill();

        c.dataset.idx = idx;
      });
    }

    // Load seal image
    const sealImg = new Image();
    sealImg.crossOrigin = "anonymous";
    sealImg.src = SEAL_IMAGE;
    sealImg.onload = ()=> createSealFragments(sealImg);

    /* ==== Animations ==== */
    function breakSeal(){
      // animiere Fragmente in unterschiedliche Richtungen, etwas zackig
      const frags = Array.from(sealWrap.querySelectorAll('canvas.seal-frag'));
      if(!frags.length) return;
      // HH ausblenden
      gsap.to(sealHH, {opacity:0, duration:.35});

      frags.forEach((c,i)=>{
        const dir = [
          {x:  1.0, y:-0.5, r: 22},
          {x:  0.6, y: 1.0, r: 16},
          {x: -0.8, y: 0.8, r:-20},
          {x: -1.1, y:-0.2, r:-28},
        ][i] || {x:(Math.random()-.5)*1.8, y:(Math.random()-.4)*1.4, r:(Math.random()-.5)*50};
        const dist = 140 + Math.random()*90;

        // kleiner „Riss“-Impuls
        gsap.fromTo(c, {scale:1, rotation:0}, {duration:.14, scale:1.04, yoyo:true, repeat:1, ease:"power1.inOut"});

        // Hauptflug
        gsap.to(c, {
          duration: .9 + Math.random()*.35,
          x: dir.x*dist + (Math.random()*24-12),
          y: dir.y*dist + (Math.random()*24-12),
          rotation: dir.r + (Math.random()*16-8),
          ease: "power2.in",
          onComplete(){ /* nada */ }
        });
      });

      // Nach ~2.4s alles wegfaden
      setTimeout(()=>{
        frags.forEach(c=> gsap.to(c, {opacity:0, scale:.7, duration:.45, onComplete:()=> c.remove()}));
        gsap.to(sealWrap, {opacity:0, duration:.45});
        clickHint.textContent = "Klick aufs Kuvert";
      }, 2400);

      state = 1;
    }

    function openEnvelope(){
      // Halten wir die Flaps simpel: beide klappen auf (Y-Rotation), während die Karte wächst
      gsap.to(flapLeft,  {duration:.9, rotationY:-180, ease:"power3.out"});
      gsap.to(flapRight, {duration:.9, rotationY: 180, ease:"power3.out"});

      // Diamant zentriert sich und wird groß (kleiner Rand bleibt)
      diamondWrap.setAttribute('aria-hidden','false');
      gsap.to('.diamond', {duration:1.05, opacity:1, scale:1, rotation:45, ease:"back.out(1.3)"});
      clickHint.textContent = "Klick auf den Diamanten";
      state = 2;
    }

    function openDiamond(){
      if(diamondOpen) return;
      diamondOpen = true;
      gsap.to('.piece.top',    {duration:1.0, rotationX:-180, transformOrigin:"50% 100%", ease:"power3.out"});
      gsap.to('.piece.bottom', {duration:1.0, rotationX: 180, transformOrigin:"50% 0%",   ease:"power3.out"});
      gsap.to('.piece.left',   {duration:1.0, rotationY:-180, transformOrigin:"100% 50%", ease:"power3.out"});
      gsap.to('.piece.right',  {duration:1.0, rotationY: 180, transformOrigin:"0% 50%",   ease:"power3.out"});
      gsap.to(inner, {duration:.6, opacity:1, delay:.75});
      clickHint.textContent = "Viel Spaß 🎉";
      state = 3;
    }

    /* ==== Click handling ==== */
    frame.addEventListener('click', (ev)=>{
      if(state === 0){
        breakSeal();
      } else if(state === 1){
        openEnvelope();
      }
    });

    // Diamond click
    diamond.addEventListener('click', (ev)=>{
      if(state === 2) openDiamond();
    });
    diamond.addEventListener('keydown', (e)=>{
      if((e.key === 'Enter' || e.key === ' ') && state===2){ e.preventDefault(); openDiamond(); }
    });

    // kleine „atme“-Animation auf dem Siegel als Hinweis
    gsap.fromTo(sealWrap, {y:-4, opacity:.98}, {y:4, opacity:1, duration:1.6, ease:"sine.inOut", yoyo:true, repeat:-1, repeatDelay:2.2});

    // set diamond image on load (falls du das Bild austauschst)
    document.querySelectorAll('.piece').forEach(p=> p.style.backgroundImage = `url("${DIAMOND_IMAGE}")`);
  </script>
</body>
</html>
