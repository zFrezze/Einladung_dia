<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Einladung</title>
<style>
  :root{ --ink:#0e1b2b; --shadow:0 24px 70px rgba(10,20,40,.18); }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;display:grid;place-items:center;background:linear-gradient(180deg,#fff,#eef4fa);
       font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto;color:var(--ink);overflow:hidden;padding:18px}
  .hint{opacity:.75;font-size:.92rem;margin-bottom:10px;text-align:center}

/* ===== Envelope (one image) ===== */
.env-frame{position:relative;width:min(640px,94vw);aspect-ratio:4/3;perspective:1600px;isolation:isolate}
.env-body{
  position:absolute;inset:0;border-radius:14px;overflow:hidden;z-index:1;
  background:url("envelope.jpg") center/cover no-repeat; box-shadow:0 24px 70px rgba(10,20,40,.18);
}

/* Innenfütterung (sichtbar wenn offen) */
.env-liner{
  position:absolute;inset:0;z-index:2;opacity:0;pointer-events:none;
  background:linear-gradient(180deg,#fff,#f4f6f9); /* Innenseite */
}

/* Patch deckt die gedruckte Klappe im Body ab (Dreieck) */
.env-patch{
  position:absolute;inset:0;z-index:2;opacity:0;pointer-events:none;
  background:#f7f9fc; /* leicht heller als Body */
  clip-path:polygon(0 0,100% 0,50% 57%);
}

/* Top-Klappe klappt nach oben und BLEIBT sichtbar */
.flap-top{
  position:absolute;inset:0;z-index:3;transform-style:preserve-3d;
  background:url("envelope.jpg") center/cover no-repeat;
  border-top-left-radius:14px;border-top-right-radius:14px;
  clip-path:polygon(0 0,100% 0,50% 57%);
  transform-origin:50% 0%;
  backface-visibility:visible;   /* wichtig: nicht verschwinden */
  transform:rotateX(0deg);
}
/* Rückseite der Klappe (Papier) */
.flap-top::after{
  content:""; position:absolute; inset:0; border-top-left-radius:14px;border-top-right-radius:14px;
  clip-path:inherit; background:linear-gradient(180deg,#ffffff,#eef2f7);
  transform:rotateY(180deg); /* zeigt sich, wenn die Vorderseite „hinten“ ist */
}

/* Schatten unter der Klappenkante */
.flap-shadow{ position:absolute; left:8%; right:8%; top:52%; height:16px; z-index:2;
  background:radial-gradient(50% 100% at 50% 0%, rgba(0,0,0,.18), transparent 70%);
  filter:blur(2px); opacity:.55; pointer-events:none;
}


  @media (max-width:540px){
    .seal-wrap{width:100px;height:100px}
  }
</style>
</head>
<body>
  <div>
    <p class="hint">Klick 1: Siegel zersplittert · Klick 2: Klappe klappt nach oben & bleibt offen · Klick auf Diamant: Karte klappt auf</p>

    <div class="env-frame" id="frame" role="region" aria-label="Einladung">
      <div class="env-body"></div>
      <div class="flap-top" id="flapTop" aria-hidden="true"></div>
      <div class="flap-shadow" id="flapShadow" aria-hidden="true"></div>

      <!-- Seal (intakt + Fragmente) -->
      <div class="seal-wrap" id="sealWrap">
        <div class="seal-intact" id="sealIntact">
          <img src="seal.png" alt="Wachssiegel"><div class="seal-hh" id="sealHH">HH</div>
        </div>
        <!-- Canvas-Fragmente werden per JS erstellt -->
      </div>

      <!-- Diamond card -->
      <div class="diamond-wrap" id="diamondWrap" aria-hidden="true">
        <div class="diamond" id="diamond" tabindex="0" role="button" aria-label="Diamantkarte">
          <div class="piece top"></div><div class="piece right"></div>
          <div class="piece bottom"></div><div class="piece left"></div>
          <div class="inner" id="inner">
            <h2>Einladung</h2>
            <p><strong>Wann:</strong> 12. Oktober 2025 · 18:00</p>
            <p><strong>Wo:</strong> Crystal Hall, Hauptstraße 12</p>
            <p>Wir freuen uns auf dich! ✨</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script>
    /* ---------- State ---------- */
    let state = 0, diamondOpen = false;

    /* ---------- DOM ---------- */
    const frame = document.getElementById('frame');
    const flapTop = document.getElementById('flapTop');
    const flapShadow = document.getElementById('flapShadow');
    const sealWrap = document.getElementById('sealWrap');
    const sealIntact = document.getElementById('sealIntact');
    const sealHH = document.getElementById('sealHH');
    const diamondWrap = document.getElementById('diamondWrap');
    const diamond = document.getElementById('diamond');
    const inner = document.getElementById('inner');

    /* ---------- Seal fragments (hidden initially) ---------- */
    const POLYS = [
      [ {x:.50,y:.10},{x:.86,y:.22},{x:.92,y:.40},{x:.70,y:.52},{x:.52,y:.42} ],
      [ {x:.52,y:.42},{x:.70,y:.52},{x:.64,y:.78},{x:.48,y:.90},{x:.42,y:.64} ],
      [ {x:.42,y:.64},{x:.48,y:.90},{x:.22,y:.84},{x:.14,y:.62},{x:.28,y:.48} ],
      [ {x:.28,y:.48},{x:.14,y:.62},{x:.10,y:.38},{x:.28,y:.22},{x:.50,y:.10} ],
    ];
    const sealImg = new Image();
    sealImg.crossOrigin="anonymous";
    sealImg.src="seal.png";
    sealImg.onload=()=>createSealFragments(sealImg);

    function createSealFragments(img){
      Array.from(sealWrap.querySelectorAll('canvas.seal-frag')).forEach(n=>n.remove());
      const size = Math.round(sealWrap.clientWidth || 130);
      POLYS.forEach(poly=>{
        const c=document.createElement('canvas'); c.className='seal-frag'; c.width=size; c.height=size;
        sealWrap.appendChild(c); const g=c.getContext('2d');
        g.save(); g.beginPath();
        poly.forEach((p,i)=>{const x=p.x*size,y=p.y*size; i?g.lineTo(x,y):g.moveTo(x,y);});
        g.closePath(); g.clip();
        const iw=img.width, ih=img.height, s=Math.max(size/iw,size/ih);
        g.drawImage(img,(size-iw*s)/2,(size-ih*s)/2,iw*s,ih*s); g.restore();
        g.globalCompositeOperation='multiply'; g.fillStyle='rgba(0,0,0,.06)'; g.beginPath();
        poly.forEach((p,i)=>{const x=p.x*size,y=p.y*size; i?g.lineTo(x,y):g.moveTo(x,y);});
        g.closePath(); g.fill();
      });
    }

    /* ---------- Actions ---------- */
    function breakSeal(){
      // intaktes Bild ausblenden, Fragmente animieren
      gsap.to(sealIntact,{duration:.35, scale:.9, opacity:0, onComplete(){
        sealIntact.style.display='none';
        const frags=Array.from(sealWrap.querySelectorAll('canvas.seal-frag'));
        frags.forEach((c,i)=>{
          c.style.opacity=1;
          const dir=[{x:1.0,y:-0.5,r:22},{x:0.6,y:1.0,r:16},{x:-0.8,y:0.8,r:-20},{x:-1.1,y:-0.2,r:-28}][i] ||
                    {x:(Math.random()-.5)*1.8,y:(Math.random()-.4)*1.4,r:(Math.random()-.5)*50};
          const dist=140+Math.random()*90;
          gsap.fromTo(c,{scale:1},{duration:.14,scale:1.04,yoyo:true,repeat:1});
          gsap.to(c,{duration:.95+Math.random()*.35,x:dir.x*dist+(Math.random()*24-12),
                     y:dir.y*dist+(Math.random()*24-12),rotation:dir.r+(Math.random()*16-8),
                     ease:"power2.in"});
        });
        setTimeout(()=>{ frags.forEach(c=>gsap.to(c,{opacity:0,scale:.7,duration:.45,onComplete:()=>c.remove()})); },2400);
      }});
      state=1;
    }

    function openEnvelope(){
      // Top flap klappt nach oben und bleibt offen
      gsap.to(flapTop,{duration:1.0, rotationX:-170, ease:"power3.out"});
      // Schatten wandert/nimmt ab
      gsap.to(flapShadow,{duration:1.0, opacity:.15, y:-30, ease:"power3.out"});

      // Diamant erscheint zentriert (mit Rand)
      diamondWrap.removeAttribute('aria-hidden');
      gsap.to('.diamond',{duration:1.05, opacity:1, scale:1, rotation:45, ease:"back.out(1.25)"});
      state=2;
    }

    function openDiamond(){
      if(diamondOpen) return; diamondOpen = true;
      gsap.to('.top',   {duration:1.0, rotationX:-180, transformOrigin:"50% 100%", ease:"power3.out"});
      gsap.to('.bottom',{duration:1.0, rotationX: 180, transformOrigin:"50% 0%",   ease:"power3.out"});
      gsap.to('.left',  {duration:1.0, rotationY:-180, transformOrigin:"100% 50%", ease:"power3.out"});
      gsap.to('.right', {duration:1.0, rotationY: 180, transformOrigin:"0% 50%",   ease:"power3.out"});
      gsap.to(inner,{duration:.6, opacity:1, delay:.75}); state=3;
    }

    /* ---------- Interaction ---------- */
    frame.addEventListener('click', ()=>{
      if(state===0) breakSeal();
      else if(state===1) openEnvelope();
    });
    diamond.addEventListener('click', ()=>{ if(state===2) openDiamond(); });
    diamond.addEventListener('keydown', (e)=>{ if((e.key==='Enter'||e.key===' ')&&state===2){e.preventDefault();openDiamond();}});

    // sanfter „atmen“-Hinweis auf dem intakten Siegel
    gsap.fromTo('#sealIntact',{y:-3, opacity:.98},{y:3, opacity:1, duration:1.6, ease:"sine.inOut", yoyo:true, repeat:-1, repeatDelay:2.0});
  </script>
</body>
</html>
