<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interaktive Einladungs-Website</title>
<style>
  :root{
    --bg: #eef6fb;
    --card-bg: #fff;
    --accent: #b30000;
    --envelope-w: 420px;
    --envelope-h: 300px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#111;background:linear-gradient(180deg,#f7fbff,#eef6fb);display:flex;align-items:center;justify-content:center;padding:20px}
  .stage{width:min(980px,100%);display:flex;flex-direction:column;align-items:center;gap:18px}
  h1{margin:0 0 6px;font-size:20px}
  p.hint{margin:0;color:#405770;font-size:13px;opacity:.9}

  /* Envelope container */
  .envelope-wrap{position:relative;width:var(--envelope-w);height:var(--envelope-h);perspective:1400px}
  .envelope{
    position:absolute;inset:0;border-radius:10px;overflow:visible;
    transform-style:preserve-3d;
  }

  /* Envelope textured body (under flaps) */
  .env-body{
    position:absolute;inset:0;border-radius:10px;
    background-size:cover;background-position:center;
    box-shadow:0 18px 40px rgba(12,24,40,0.12);
    transform:translateZ(0);
    z-index:1;
  }

  /* Flap halves (left/right) that will open */
  .flap-left, .flap-right{
    position:absolute;top:0;height:100%;width:50%;
    background-size:cover;background-position:center;
    z-index:3;
    transform-origin:center left;
    backface-visibility:hidden;
  }
  .flap-left{left:0;border-top-left-radius:10px;border-bottom-left-radius:10px;transform-origin:left center}
  .flap-right{right:0;border-top-right-radius:10px;border-bottom-right-radius:10px;transform-origin:right center}

  /* top decorative band (slightly raised) */
  .env-band{position:absolute;left:0;right:0;top:36%;height:12%;z-index:4;pointer-events:none;filter:blur(.2px);opacity:.9}

  /* Seal canvas wrapper */
  .seal-holder{
    position:absolute;left:50%;top:47%;transform:translate(-50%,-50%);
    width:120px;height:120px;z-index:6;pointer-events:none;
  }
  /* individual fragment canvases will be appended here */
  .seal-frag{position:absolute;left:0;top:0;width:120px;height:120px;pointer-events:auto;z-index:7}

  /* Diamond card (initially hidden) */
  .diamond-wrap{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    width:280px;height:280px;z-index:8;pointer-events:none;
  }
  .diamond{
    width:100%;height:100%;transform:rotate(45deg) scale(0);
    transform-origin:center center;position:relative;cursor:pointer;
    box-shadow:0 26px 60px rgba(0,0,0,0.24);border-radius:6px;overflow:visible;
    pointer-events:auto;
  }

  /* the four flaps that form the diamond (use background-image from DIAMOND URL) */
  .diamond .piece{
    position:absolute;width:50%;height:50%;background-size:cover;background-position:center;border:1px solid rgba(0,0,0,0.06);
    backface-visibility:hidden;transform-style:preserve-3d;
  }
  .diamond .top{left:25%;top:0;transform-origin:50% 100%}
  .diamond .bottom{left:25%;bottom:0;transform-origin:50% 0%}
  .diamond .left{left:0;top:25%;transform-origin:100% 50%}
  .diamond .right{right:0;top:25%;transform-origin:0% 50%}

  /* inner content (hidden until open) - aligned square inside diamond (rotated back) */
  .diamond .inner{
    position:absolute;left:20%;top:20%;width:60%;height:60%;transform:rotate(-45deg);
    background:var(--card-bg);border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px;opacity:0;
    box-shadow:0 6px 30px rgba(0,0,0,0.12);
    text-align:center;
  }
  .diamond .inner h2{margin:0 0 6px;font-size:18px}
  .diamond .inner p{margin:4px 0;color:#33475b;font-size:14px}

  /* utility */
  .hidden{display:none}

  /* responsive */
  @media (max-width:520px){
    :root{--envelope-w:320px;--envelope-h:230px}
    .diamond-wrap{width:220px;height:220px}
    .seal-holder{width:96px;height:96px}
  }
</style>
</head>
<body>
  <div class="stage">
    <h1>Interaktive Einladung — Klick zuerst das Siegel</h1>
    <p class="hint">1) Siegel klicken → bricht in 3–4 Stücke. 2) Nochmal auf den Umschlag klicken → Umschlag öffnet. 3) Diamant klicken → Karte klappt auf.</p>

    <div class="envelope-wrap" aria-live="polite">
      <!-- Envelope & textured body -->
      <div class="envelope" id="envelope" role="button" aria-pressed="false" tabindex="0" aria-label="Ein Umschlag">
        <div class="env-body" id="envBody" style="background-image: url('https://cdn.pixabay.com/photo/2019/08/20/07/27/paper-texture-4412128_1280.jpg');"></div>

        <!-- left/right flaps (share same texture to look continuous) -->
        <div class="flap-left" id="flapLeft" style="background-image: url('https://cdn.pixabay.com/photo/2019/08/20/07/27/paper-texture-4412128_1280.jpg');"></div>
        <div class="flap-right" id="flapRight" style="background-image: url('https://cdn.pixabay.com/photo/2019/08/20/07/27/paper-texture-4412128_1280.jpg');"></div>

        <!-- decorative band (subtle) -->
        <div class="env-band" aria-hidden="true"></div>

        <!-- seal canvas holder (we will draw the seal here and split into fragments) -->
        <div class="seal-holder" id="sealHolder" aria-hidden="true" title="Wachssiegel">
          <!-- canvases appended here by script -->
        </div>
      </div>

      <!-- diamond card (appears after opening) -->
      <div class="diamond-wrap" id="diamondWrap" aria-hidden="true">
        <div class="diamond" id="diamond" role="button" tabindex="0" aria-label="Diamantkarte">
          <div class="piece top"    style="background-image: url('https://picsum.photos/600/600');"></div>
          <div class="piece right"  style="background-image: url('https://picsum.photos/600/600');"></div>
          <div class="piece bottom" style="background-image: url('https://picsum.photos/600/600');"></div>
          <div class="piece left"   style="background-image: url('https://picsum.photos/600/600');"></div>
          <div class="inner" id="diamondInner">
            <h2>Einladung</h2>
            <p><strong>Wann:</strong> 12. Oktober 2025, 18:00</p>
            <p><strong>Wo:</strong> Crystal Hall, Hauptstraße 12</p>
            <p>Dresscode: Sparkly ✨</p>
          </div>
        </div>
      </div>
    </div>

    <p class="hint">Hinweis: Ersetze die Textur-URLs im HTML (envBody background-image, seal URL in JS, diamond background-image) durch deine eigenen Bilder.</p>
  </div>

  <!-- GSAP CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script>
  /* ------------------------
     Konfiguration / Platzhalter-URLs
     ------------------------ */
  const SEAL_URL = 'https://discord.com/channels/1061601814258122772/1061601814920826934/1411067174763757810';
    // Pixabay Beispiel (ohne HH). Ersetze durch deine eigene Wachs-Textur mit transparentem Hintergrund.
  const ENVELOPE_TEXTURE_URL = ''; // falls du per JS setzen möchtest (aktuell per inline style)
  const DIAMOND_PLACEHOLDER = 'https://picsum.photos/800/800'; // ersetze später

  /* ------------------------
     Setup DOM-Referenzen
     ------------------------ */
  const envelope = document.getElementById('envelope');
  const flapLeft = document.getElementById('flapLeft');
  const flapRight = document.getElementById('flapRight');
  const sealHolder = document.getElementById('sealHolder');
  const diamondWrap = document.getElementById('diamondWrap');
  const diamond = document.getElementById('diamond');
  const diamondInner = document.getElementById('diamondInner');

  // State machine
  // 0 = initial, 1 = seal broken, 2 = envelope opened (diamond visible), 3 = diamond open
  let state = 0;

  /* ------------------------
     Load seal image into offscreen canvas, then create fragments
     ------------------------ */
  const fragConfigs = [
    // polygons are in normalized 0..1 coords relative to canvas size (120x120)
    // designed to produce irregular 3-4 pieces
    [{x:.5,y:.05},{x:.95,y:.25},{x:.7,y:.6},{x:.45,y:.45},{x:.25,y:.25}],
    [{x:.05,y:.3},{x:.3,y:.48},{x:.45,y:.45},{x:.25,y:.25}],
    [{x:.45,y:.45},{x:.7,y:.6},{x:.85,y:.95},{x:.5,y:.95}],
    [{x:.25,y:.7},{x:.45,y:.95},{x:.05,y:.95},{x:.15,y:.6}]
  ];

  function createSealFragments(img){
    // clear any existing children
    sealHolder.innerHTML = '';
    const size = Math.round(sealHolder.clientWidth || 120);
    fragConfigs.forEach((poly, idx) => {
      const c = document.createElement('canvas');
      c.className = 'seal-frag';
      c.width = size; c.height = size;
      c.style.width = size + 'px';
      c.style.height = size + 'px';
      c.style.left = '0px';
      c.style.top = '0px';
      // make sure fragments capture pointer events (so user can click through)
      c.style.pointerEvents = 'none';
      sealHolder.appendChild(c);
      const ctx = c.getContext('2d');
      ctx.save();
      ctx.beginPath();
      poly.forEach((pt, i) => {
        const x = pt.x * size;
        const y = pt.y * size;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
      ctx.clip();
      // center and draw the image (cover)
      const iw = img.width, ih = img.height;
      // scale cover
      const scale = Math.max(size/iw, size/ih);
      const dw = iw*scale, dh = ih*scale;
      const dx = (size - dw)/2, dy = (size - dh)/2;
      ctx.drawImage(img, dx, dy, dw, dh);
      ctx.restore();
      // add a small shadow / emboss effect to look waxy
      ctx.globalCompositeOperation = 'source-over';
      // subtle outer glow
      ctx.fillStyle = 'rgba(0,0,0,0.06)';
      ctx.beginPath();
      poly.forEach((pt,i)=> {
        const x = pt.x*size, y = pt.y*size;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
      ctx.fill();
      // store reference for animation
      c.dataset.fragIndex = idx;
    });
  }

  // load seal image
  const sealImg = new Image();
  sealImg.crossOrigin = 'anonymous';
  sealImg.src = SEAL_URL;
  sealImg.onload = ()=> {
    createSealFragments(sealImg);
    // draw HH text in center on top (we overlay an SVG text for crispness)
    const svgText = document.createElementNS('http://www.w3.org/2000/svg','svg');
    svgText.setAttribute('viewBox','0 0 120 120');
    svgText.style.position = 'absolute';
    svgText.style.left = '0';
    svgText.style.top = '0';
    svgText.style.width = '100%';
    svgText.style.height = '100%';
    svgText.style.zIndex = 9;
    svgText.style.pointerEvents = 'none';
    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x','60'); text.setAttribute('y','72');
    text.setAttribute('text-anchor','middle');
    text.setAttribute('font-weight','700');
    text.setAttribute('font-size','28');
    text.setAttribute('fill','rgba(255,255,255,0.95)');
    text.setAttribute('font-family','Georgia, serif');
    text.textContent = 'HH';
    svgText.appendChild(text);
    sealHolder.appendChild(svgText);
    // make sealHolder pointer-events only on children fragments
    sealHolder.style.pointerEvents = 'auto';
  };

  /* ------------------------
     Animate the seal fragments away (irregular zackig)
     ------------------------ */
  function breakSealAndAnimate(){
    // grab canvases (fragments)
    const frags = Array.from(sealHolder.querySelectorAll('canvas.seal-frag'));
    if(!frags.length) return;
    // enable pointer events
    frags.forEach(f=> f.style.pointerEvents = 'auto');
    // animate each piece out with different vectors
    frags.forEach((c, i)=>{
      // compute random-ish direction per fragment
      const dir = [
        {x:-1,y:-0.6,rot:-30},
        {x:1,y:-0.4,rot:25},
        {x:.6,y:1.0,rot:20},
        {x:-.4,y:0.9,rot:-20}
      ][i] || {x:(Math.random()-.5)*2,y:(Math.random()-.8),rot:(Math.random()-.5)*60};
      const dist = 140 + Math.random()*80;
      gsap.to(c, {
        duration: 0.9 + Math.random()*0.4,
        x: dir.x * dist + (Math.random()*20-10),
        y: dir.y * dist + (Math.random()*20-10),
        rotation: dir.rot + (Math.random()*20-10),
        ease: "power2.in",
        opacity: 0.95,
        onStart(){ c.style.pointerEvents='none'; }
      });
    });
    // fade out the HH svg text overlay
    const svg = sealHolder.querySelector('svg');
    if(svg) gsap.to(svg, {duration:0.4, opacity:0, delay:0.05});
    // after a little while, remove fragments smoothly
    setTimeout(()=>{
      const all = Array.from(sealHolder.querySelectorAll('*'));
      all.forEach(n => {
        gsap.to(n, {opacity:0, scale:0.6, duration:0.5, onComplete: ()=> n.remove()});
      });
    }, 2400);
  }

  /* ------------------------
     Envelope open (two-halves) and diamond appear
     ------------------------ */
  function openEnvelopeAndRevealDiamond(){
    // set envelope as opened
    envelope.setAttribute('aria-pressed','true');
    // animate flaps: left rotates negative Y (opens left), right rotates positive Y (opens right)
    gsap.to(flapLeft, {duration:0.9, rotationY: -180, transformOrigin:"left center", ease:"power3.out"});
    gsap.to(flapRight, {duration:0.9, rotationY: 180, transformOrigin:"right center", ease:"power3.out"});
    // small z-lift of body
    gsap.to(document.getElementById('envBody'), {duration:0.8, y:-12});
    // diamond scales in and moves upward slightly to be centered and larger (but leave a small margin)
    diamondWrap.style.pointerEvents = 'auto';
    diamondWrap.setAttribute('aria-hidden','false');
    gsap.to(diamond, {duration:1.05, scale:1, rotation:45, ease:"back.out(1.3)", onStart(){
      // ensure diamond pieces get the texture (use DIAMOND_PLACEHOLDER)
      const imgs = diamond.querySelectorAll('.piece');
      imgs.forEach(el => el.style.backgroundImage = `url(${DIAMOND_PLACEHOLDER})`);
    }});
    state = 2;
  }

  /* ------------------------
     Diamond open (4 flaps)
     ------------------------ */
  let diamondOpen = false;
  function openDiamond(){
    if(diamondOpen) return;
    diamondOpen = true;
    // rotate flaps away
    gsap.to('.diamond .top', {duration:1.0, rotationX: -180, transformOrigin:"50% 100%", ease:"power3.out"});
    gsap.to('.diamond .bottom', {duration:1.0, rotationX: 180, transformOrigin:"50% 0%", ease:"power3.out"});
    gsap.to('.diamond .left', {duration:1.0, rotationY: -180, transformOrigin:"100% 50%", ease:"power3.out"});
    gsap.to('.diamond .right', {duration:1.0, rotationY: 180, transformOrigin:"0% 50%", ease:"power3.out"});
    gsap.to(diamondInner, {duration:0.6, opacity:1, delay:0.75});
    state = 3;
  }

  /* ------------------------
     Click handlers / keyboard accessibility
     ------------------------ */
  envelope.addEventListener('click', (e)=>{
    // If seal fragments are still present and state 0 -> break them
    if(state === 0){
      breakSealAndAnimate();
      state = 1;
      return;
    }
    // If seal already broken (state 1) -> open envelope
    if(state === 1){
      openEnvelopeAndRevealDiamond();
      return;
    }
    // if already open and user clicks envelope again, do nothing or re-open diamond
  });

  // Allow keyboard activation (space/enter)
  envelope.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); envelope.click(); }
  });

  // click on diamond to open it
  diamond.addEventListener('click', (e)=>{
    if(state === 2) openDiamond();
  });
  diamond.addEventListener('keydown', (e)=>{
    if((e.key === 'Enter' || e.key === ' ') && state === 2){ e.preventDefault(); openDiamond(); }
  });

  /* ------------------------
     Initial positioning: make sure fragments are there after image load
     ------------------------ */
  // If the image loads earlier, createSealFragments already ran.
  // If user resizes, fragments scale with holder size; for simplicity we won't re-create on resize,
  // but you can call createSealFragments again if you replace the seal texture.

  /* ------------------------
     Optional: initialize a tiny bounce to hint user to click
     ------------------------ */
  gsap.from('.seal-holder', {duration:1.2, y:-6, repeat:-1, yoyo:true, opacity:0.95, ease:'sine.inOut', repeatDelay:2.6});
  </script>
</body>
</html>
