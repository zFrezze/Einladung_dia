<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Einladung</title>
<style>
  :root{
    --ink:#0e1b2b;
    --paper-hi:#ffffff; --paper-mid:#eef2f7; --paper-lo:#dfe6ee;
    --liner-hi:#ffffff; --liner-lo:#eaf0f7;
    --shadow-strong: 0 30px 90px rgba(10,20,40,.28);
    --shadow-soft:   0 16px 40px rgba(10,20,40,.14);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;display:grid;place-items:center;background:linear-gradient(180deg,#f9fbff,#edf3fa);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);
    overflow:hidden;padding:18px
  }

  /* ===== Umschlag (gebaut, mit Kontrast) ===== */
  .env-frame{position:relative;width:min(700px,94vw);aspect-ratio:4/3;perspective:1800px;isolation:isolate;overflow:visible}
  .env-body{
    position:absolute;inset:0;border-radius:18px;overflow:hidden;z-index:2;
    background:
      radial-gradient(140% 100% at 0% 50%, rgba(255,255,255,.90) 0%, transparent 60%),
      radial-gradient(140% 100% at 100% 50%, rgba(0,0,0,.06) 0%, transparent 60%),
      linear-gradient(180deg,var(--paper-hi) 0%, var(--paper-mid) 60%, var(--paper-lo) 100%);
    box-shadow: var(--shadow-strong);
  }
  .env-body::before{
    content:"";position:absolute;inset:0;border-radius:18px;pointer-events:none;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.10), inset 0 18px 22px rgba(0,0,0,.06);
  }
  .env-body::after{
    content:"";position:absolute;inset:0;pointer-events:none;opacity:.25;mix-blend:multiply;
    background-image:
      radial-gradient(1px 1px at 25% 30%, rgba(0,0,0,.05) 50%, transparent 51%),
      radial-gradient(1px 1px at 60% 60%, rgba(0,0,0,.05) 50%, transparent 51%),
      radial-gradient(1px 1px at 80% 20%, rgba(0,0,0,.05) 50%, transparent 51%),
      radial-gradient(1px 1px at 40% 80%, rgba(0,0,0,.05) 50%, transparent 51%);
    background-size: 120px 120px, 140px 140px, 160px 160px, 180px 180px;
  }

  .env-liner{
    position:absolute;inset:0;border-radius:18px;z-index:1;opacity:0;pointer-events:none;
    background:linear-gradient(180deg,var(--liner-hi),var(--liner-lo));
  }
  /* Patch deckt die gedachte Klappe im Body ab (macht offenen Look) */
  .env-patch{
    position:absolute;inset:0;border-radius:18px;z-index:2;opacity:0;pointer-events:none; /* <— unter der Klappe, über Liner/Body */
    background:var(--liner-hi);
    clip-path:polygon(0 0,100% 0,50% 57%);
    box-shadow:0 1px 0 rgba(0,0,0,.10) inset;
  }

  .flap-top{
    position:absolute;inset:0;z-index:4;transform-style:preserve-3d;
    background: linear-gradient(180deg,#ffffff 0%, #f3f7fb 100%);
    border-top-left-radius:18px;border-top-right-radius:18px;
    clip-path:polygon(0 0,100% 0,50% 57%);
    transform-origin:50% 0%; backface-visibility:visible; transform:rotateX(0deg);
    box-shadow: 0 24px 50px rgba(0,0,0,.16);
  }
  .flap-top::before{
    content:""; position:absolute; inset:0; clip-path:inherit; border-top-left-radius:18px;border-top-right-radius:18px;
    background:radial-gradient(160% 70% at 50% 30%, rgba(0,0,0,.18), transparent 55%);
    mix-blend:multiply; opacity:.22; pointer-events:none;
  }
  .flap-top::after{
    content:""; position:absolute; inset:0; clip-path:inherit; border-top-left-radius:18px;border-top-right-radius:18px;
    background:linear-gradient(180deg,#ffffff,#e9eff6);
    transform:rotateY(180deg);
  }
  .flap-shadow{
    position:absolute;left:8%;right:8%;top:52%;height:18px;z-index:3;
    background:radial-gradient(50% 100% at 50% 0%, rgba(0,0,0,.22), transparent 70%);
    filter:blur(2px);opacity:.6;pointer-events:none;
  }

  /* ===== Siegel ===== */
  .seal-wrap{position:absolute;left:50%;top:48%;transform:translate(-50%,-50%);width:140px;height:140px;z-index:6}
  .seal-intact{position:absolute;inset:0;display:grid;place-items:center}
  .seal-intact img{width:100%;height:auto;display:block}
  .seal-hh{position:absolute;inset:0;display:grid;place-items:center;font:700 30px/1 Georgia,serif;color:rgba(255,255,255,.96);text-shadow:0 2px 6px rgba(0,0,0,.35);pointer-events:none}
  canvas.seal-frag{position:absolute;inset:0;width:100%;height:100%;opacity:1;pointer-events:none;display:none}

/* ===== Karte (ein Bild, erst durch Dreiecks-Öffnung sichtbar) ===== */
.card-wrap{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:min(460px,76vmin);height:min(460px,76vmin);
  z-index:3;                      /* über Body/Patch, unter Flap */
  pointer-events:none;overflow:visible;

  /* Clip genau wie die Lasche/der Patch – nur dort wird die Karte anfangs sichtbar */
  clip-path:polygon(0 0,100% 0,50% 57%);
}

.card-img{
  position:absolute;left:50%;top:50%;
  /* Start: knapp UNTER der Öffnung, damit sie früher erscheint */
  transform:translate(-50%,-50%) translateY(60%) scale(.48);
  width:100%;height:auto;opacity:0.95;
  filter: drop-shadow(0 30px 70px rgba(0,0,0,.25));
  pointer-events:auto;cursor:pointer;user-select:none;
}

</style>
</head>
<body>
  <div class="env-frame" id="frame" role="region" aria-label="Einladung">
    <!-- Umschlag -->
    <div class="env-body" id="envBody"></div>
    <div class="env-liner" id="envLiner"></div>
    <div class="env-patch" id="envPatch"></div>
    <div class="flap-top" id="flapTop" aria-hidden="true"></div>
    <div class="flap-shadow" id="flapShadow" aria-hidden="true"></div>

    <!-- Siegel -->
    <div class="seal-wrap" id="sealWrap" title="Siegel">
      <div class="seal-intact" id="sealIntact">
        <img src="seal.png" alt="Wachssiegel">
        <div class="seal-hh" id="sealHH">HH</div>
      </div>
      <!-- Canvas-Fragmente werden per JS erzeugt (initial display:none) -->
    </div>

    <!-- Karte (ein Bild) -->
    <div class="card-wrap" id="cardWrap" aria-hidden="true">
      <img src="diamond.jpg" alt="Einladungskarte" id="cardImg" class="card-img">
    </div>
  </div>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script>
    let state = 0;

    const frame = document.getElementById('frame');
    const flapTop = document.getElementById('flapTop');
    const flapShadow = document.getElementById('flapShadow');
    const envLiner = document.getElementById('envLiner');
    const envPatch = document.getElementById('envPatch');
    const sealWrap = document.getElementById('sealWrap');
    const sealIntact = document.getElementById('sealIntact');
    const sealHH = document.getElementById('sealHH');
    const cardWrap = document.getElementById('cardWrap');
    const cardImg = document.getElementById('cardImg');

    /* ---- Siegel-Fragmente vorbereiten ---- */
    const POLYS = [
      [ {x:.50,y:.10},{x:.86,y:.22},{x:.92,y:.40},{x:.70,y:.52},{x:.52,y:.42} ],
      [ {x:.52,y:.42},{x:.70,y:.52},{x:.64,y:.78},{x:.48,y:.90},{x:.42,y:.64} ],
      [ {x:.42,y:.64},{x:.48,y:.90},{x:.22,y:.84},{x:.14,y:.62},{x:.28,y:.48} ],
      [ {x:.28,y:.48},{x:.14,y:.62},{x:.10,y:.38},{x:.28,y:.22},{x:.50,y:.10} ],
    ];
    const sealImg = new Image();
    sealImg.crossOrigin = "anonymous";
    sealImg.src = "seal.png";
    sealImg.onload = () => createSealFragments(sealImg);

    function createSealFragments(img){
      Array.from(sealWrap.querySelectorAll('canvas.seal-frag')).forEach(n=>n.remove());
      const size = Math.round(sealWrap.clientWidth || 140);
      POLYS.forEach(poly=>{
        const c = document.createElement('canvas');
        c.className = 'seal-frag';
        c.width = size; c.height = size;
        c.style.display = 'none';
        sealWrap.appendChild(c);
        const g = c.getContext('2d');

        g.save(); g.beginPath();
        poly.forEach((p,i)=>{ const x=p.x*size, y=p.y*size; i?g.lineTo(x,y):g.moveTo(x,y); });
        g.closePath(); g.clip();

        const iw=img.width, ih=img.height, s=Math.max(size/iw, size/ih);
        g.drawImage(img,(size-iw*s)/2,(size-ih*s)/2, iw*s, ih*s);
        g.restore();

        g.globalCompositeOperation='multiply';
        g.fillStyle='rgba(0,0,0,.06)';
        g.beginPath();
        poly.forEach((p,i)=>{ const x=p.x*size,y=p.y*size; i?g.lineTo(x,y):g.moveTo(x,y); });
        g.closePath(); g.fill();
      });
    }

    /* ---- Animationen ---- */
function breakSealSlow(){
  // slower pop, dann Bewegung + Fade der Splitter
  gsap.to(sealIntact, {
    duration: .18, scale: 1.06, ease: "power2.out",
    yoyo: true, repeat: 1,
    onComplete(){
      sealIntact.style.display='none';
      sealHH.style.display='none';
      const frags = Array.from(sealWrap.querySelectorAll('canvas.seal-frag'));
      frags.forEach((c,i)=>{
        c.style.display='block';
        const dir = [
          {x:  0.85, y:-0.40, r: 16},
          {x:  0.55, y: 0.85, r: 12},
          {x: -0.70, y: 0.70, r:-14},
          {x: -0.95, y:-0.20, r:-18},
        ][i] || {x:(Math.random()-.5)*1.2, y:(Math.random()-.4)*1.0, r:(Math.random()-.5)*36};
        const dist = 95 + Math.random()*40;

        // Bewegung
        gsap.to(c, {duration:.55, x:dir.x*dist, y:dir.y*dist, rotation:dir.r, ease:"power2.out"});

        // danach weich ausfaden
        gsap.to(c, {duration:.35, opacity:0, delay:.55, ease:"power2.out", onComplete:()=>c.remove()});
      });
    }
  });
  state = 1;
}


function openEnvelopeAndCardTwoStage(){
  // Klappe langsam öffnen + Innenflächen
  gsap.to(flapTop,   {duration:2.0, rotationX:-120, ease:"power2.inOut"});
  gsap.to(flapShadow,{duration:2.0, opacity:.20, y:-24, ease:"power2.inOut"});
  gsap.to(envLiner,  {duration:.9,  opacity:1, delay:.5, ease:"power1.out"});
  gsap.to(envPatch,  {duration:.9,  opacity:1, delay:.5, ease:"power1.out"});

  // Timeline für Karte
  const tl = gsap.timeline({ delay: 0.95, defaults:{ ease:"power2.inOut" } });

  // 1) Auf EINMAL durch die Öffnung (geclippt, kleiner, schnell)
  tl.to(cardImg, {
    duration: 0.7,
    y: "-=60%",      // kräftig hoch durchs Dreieck
    scale: 0.50,
    opacity: 1
  });

  // 2) Clip weg, vor den Umschlag holen
  tl.add(() => {
    document.querySelector('.card-wrap').style.clipPath = 'none';
    gsap.set(cardWrap, { zIndex: 7 });
  });

  // 3) In die Mitte fliegen und währenddessen vergrößern
  tl.to(cardImg, {
    duration: 1.15,
    y: "0%",         // exakt zentriert (Wrap liegt bei top:50%)
    scale: 1.00
  });

  state = 2;
}




    /* ---- Interaction ---- */
    frame.addEventListener('click', ()=>{
      if(state===0) breakSealSlow();
      else if(state===1) openEnvelopeAndCardTwoStage();
    });
  </script>
</body>
</html>
